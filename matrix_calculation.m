clc
clear

%% Defining parameters
syms t1 t2 t3 t4...
     td1 td2 td3 td4...
     tdd1 tdd2 tdd3 tdd4 ...
     s1 s2 s3 s4...
     c1 c2 c3 c4...
     Ixy1 Ixz1 Iyz1 Ixx1 Iyy1 Izz1...
     Ixy2 Ixz2 Iyz2 Ixx2 Iyy2 Izz2...
     Ixy3 Ixz3 Iyz3 Ixx3 Iyy3 Izz3...
     Ixy4 Ixz4 Iyz4 Ixx4 Iyy4 Izz4...
     m1 m2 m3 m4...
     cx1 cx2 cx3 cx4...
     cy1 cy2 cy3 cy4...
     cz1 cz2 cz3 cz4...
     g...
     d1 d2 d3 d4 ...
    
%% Link 1
% str1 = "[-Ixz2*(c2*td1*td2 + s2*tdd1) - Iyz2*(c2*tdd1 - s2*td1*td2) + Izz1*tdd1 + Izz2*tdd2 - c2*td1*(Ixx2*s2*td1 - Ixy2*c2*td1 - Ixz2*td2) + c2*(-Ixy3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - Ixz4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + Iyy3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2)) - Iyz3*(c2*tdd1 - s2*td1*td2 + tdd3) - Iyz4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) + Izz4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) - cx3*m3*(c2*g - cx3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2)) + cy3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - (-c3*td2 - s2*s3*td1)*(-cy3*(c2*td1 + td3) + cz3*(-c3*td2 - s2*s3*td1)) + (cx3*(c2*td1 + td3) - cz3*(c3*s2*td1 - s3*td2))*(c3*s2*td1 - s3*td2)) + cx4*m4*(-c4*(c2*g - d3*(-c3*td2 - s2*s3*td1)**2 - d3*(c3*s2*td1 - s3*td2)**2) + cx4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) - cz4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) - s4*(c3*g*s2 + d3*(c2*td1 + td3)*(c3*s2*td1 - s3*td2) + d3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2))) - (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(-cx4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + cy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) + (-cy4*(-c3*td2 - s2*s3*td1 + td4) + cz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)))*(-c3*td2 - s2*s3*td1 + td4)) - cy4*m4*(c4*(c3*g*s2 + d3*(c2*td1 + td3)*(c3*s2*td1 - s3*td2) + d3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2))) - cy4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) + cz4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - s4*(c2*g - d3*(-c3*td2 - s2*s3*td1)**2 - d3*(c3*s2*td1 - s3*td2)**2) + (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(-cx4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + cy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - (cx4*(-c3*td2 - s2*s3*td1 + td4) - cz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)))*(-c3*td2 - s2*s3*td1 + td4)) + cz3*m3*(c3*g*s2 - cy3*(c2*tdd1 - s2*td1*td2 + tdd3) + cz3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2)) - (c2*td1 + td3)*(cx3*(c2*td1 + td3) - cz3*(c3*s2*td1 - s3*td2)) + (-c3*td2 - s2*s3*td1)*(-cx3*(-c3*td2 - s2*s3*td1) + cy3*(c3*s2*td1 - s3*td2))) + d3*(c3*m4*(c4*(c3*g*s2 + d3*(c2*td1 + td3)*(c3*s2*td1 - s3*td2) + d3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2))) - cy4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) + cz4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - s4*(c2*g - d3*(-c3*td2 - s2*s3*td1)**2 - d3*(c3*s2*td1 - s3*td2)**2) + (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(-cx4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + cy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - (cx4*(-c3*td2 - s2*s3*td1 + td4) - cz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)))*(-c3*td2 - s2*s3*td1 + td4)) - m4*s3*(-c4*(c2*g - d3*(-c3*td2 - s2*s3*td1)**2 - d3*(c3*s2*td1 - s3*td2)**2) + cx4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) - cz4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) - s4*(c3*g*s2 + d3*(c2*td1 + td3)*(c3*s2*td1 - s3*td2) + d3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2))) - (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(-cx4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + cy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) + (-cy4*(-c3*td2 - s2*s3*td1 + td4) + cz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)))*(-c3*td2 - s2*s3*td1 + td4))) + (c2*td1 + td3)*(Ixx3*(c3*s2*td1 - s3*td2) - Ixy3*(-c3*td2 - s2*s3*td1) - Ixz3*(c2*td1 + td3)) - (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(Ixx4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)) - Ixy4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) - Ixz4*(-c3*td2 - s2*s3*td1 + td4)) + (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(-Ixy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)) + Iyy4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) - Iyz4*(-c3*td2 - s2*s3*td1 + td4)) - (c3*s2*td1 - s3*td2)*(-Ixz3*(c3*s2*td1 - s3*td2) - Iyz3*(-c3*td2 - s2*s3*td1) + Izz3*(c2*td1 + td3))) + cx1*m1*(cx1*tdd1 - cy1*td1**2) + cx2*m2*(c2*g + cx2*tdd2 - cz2*(c2*td1*td2 + s2*tdd1) - s2*td1*(-c2*cx2*td1 + cy2*s2*td1) + td2*(c2*cz2*td1 - cy2*td2)) - cy1*m1*(-cx1*td1**2 - cy1*tdd1) - cy2*m2*(c2*td1*(-c2*cx2*td1 + cy2*s2*td1) - cy2*tdd2 + cz2*(c2*tdd1 - s2*td1*td2) + g*s2 - td2*(cx2*td2 - cz2*s2*td1)) + s2*td1*(-Ixy2*s2*td1 + Iyy2*c2*td1 - Iyz2*td2) + s2*(Ixx3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - Ixy3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2)) - Ixz3*(c2*tdd1 - s2*td1*td2 + tdd3) + c3*(Ixx4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) - Ixy4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - Ixz4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) + cy4*m4*(-cx4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) + cy4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + d3*(c2*td1 + td3)*(-c3*td2 - s2*s3*td1) - d3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - g*s2*s3 - (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(-cy4*(-c3*td2 - s2*s3*td1 + td4) + cz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(cx4*(-c3*td2 - s2*s3*td1 + td4) - cz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)))) - cz4*m4*(-c4*(c2*g - d3*(-c3*td2 - s2*s3*td1)**2 - d3*(c3*s2*td1 - s3*td2)**2) + cx4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) - cz4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) - s4*(c3*g*s2 + d3*(c2*td1 + td3)*(c3*s2*td1 - s3*td2) + d3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2))) - (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(-cx4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + cy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) + (-cy4*(-c3*td2 - s2*s3*td1 + td4) + cz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)))*(-c3*td2 - s2*s3*td1 + td4)) + (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(-Ixz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)) - Iyz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + Izz4*(-c3*td2 - s2*s3*td1 + td4)) - (-Ixy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)) + Iyy4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) - Iyz4*(-c3*td2 - s2*s3*td1 + td4))*(-c3*td2 - s2*s3*td1 + td4)) + cy3*m3*(c2*g - cx3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2)) + cy3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - (-c3*td2 - s2*s3*td1)*(-cy3*(c2*td1 + td3) + cz3*(-c3*td2 - s2*s3*td1)) + (cx3*(c2*td1 + td3) - cz3*(c3*s2*td1 - s3*td2))*(c3*s2*td1 - s3*td2)) - cz3*m3*(cx3*(c2*tdd1 - s2*td1*td2 + tdd3) - cz3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - g*s2*s3 + (c2*td1 + td3)*(-cy3*(c2*td1 + td3) + cz3*(-c3*td2 - s2*s3*td1)) - (-cx3*(-c3*td2 - s2*s3*td1) + cy3*(c3*s2*td1 - s3*td2))*(c3*s2*td1 - s3*td2)) - d3*m4*(-cx4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) + cy4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + d3*(c2*td1 + td3)*(-c3*td2 - s2*s3*td1) - d3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - g*s2*s3 - (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(-cy4*(-c3*td2 - s2*s3*td1 + td4) + cz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(cx4*(-c3*td2 - s2*s3*td1 + td4) - cz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)))) - s3*(-Ixy4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + Iyy4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - Iyz4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) - cx4*m4*(-cx4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) + cy4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + d3*(c2*td1 + td3)*(-c3*td2 - s2*s3*td1) - d3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - g*s2*s3 - (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(-cy4*(-c3*td2 - s2*s3*td1 + td4) + cz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(cx4*(-c3*td2 - s2*s3*td1 + td4) - cz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)))) + cz4*m4*(c4*(c3*g*s2 + d3*(c2*td1 + td3)*(c3*s2*td1 - s3*td2) + d3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2))) - cy4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) + cz4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - s4*(c2*g - d3*(-c3*td2 - s2*s3*td1)**2 - d3*(c3*s2*td1 - s3*td2)**2) + (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(-cx4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + cy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - (cx4*(-c3*td2 - s2*s3*td1 + td4) - cz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)))*(-c3*td2 - s2*s3*td1 + td4)) - (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(-Ixz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)) - Iyz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + Izz4*(-c3*td2 - s2*s3*td1 + td4)) + (Ixx4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)) - Ixy4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) - Ixz4*(-c3*td2 - s2*s3*td1 + td4))*(-c3*td2 - s2*s3*td1 + td4)) - (c2*td1 + td3)*(-Ixy3*(c3*s2*td1 - s3*td2) + Iyy3*(-c3*td2 - s2*s3*td1) - Iyz3*(c2*td1 + td3)) + (-c3*td2 - s2*s3*td1)*(-Ixz3*(c3*s2*td1 - s3*td2) - Iyz3*(-c3*td2 - s2*s3*td1) + Izz3*(c2*td1 + td3)))]"
% newStr1 = replace(str1,"**2","^2")

a1 = -Ixz2*(c2*td1*td2 + s2*tdd1) - Iyz2*(c2*tdd1 - s2*td1*td2) + Izz1*tdd1 + Izz2*tdd2 - c2*td1*(Ixx2*s2*td1 - Ixy2*c2*td1 - Ixz2*td2) + c2*(-Ixy3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - Ixz4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + Iyy3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2)) - Iyz3*(c2*tdd1 - s2*td1*td2 + tdd3) - Iyz4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) + Izz4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) - cx3*m3*(c2*g - cx3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2)) + cy3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - (-c3*td2 - s2*s3*td1)*(-cy3*(c2*td1 + td3) + cz3*(-c3*td2 - s2*s3*td1)) + (cx3*(c2*td1 + td3) - cz3*(c3*s2*td1 - s3*td2))*(c3*s2*td1 - s3*td2)) + cx4*m4*(-c4*(c2*g - d3*(-c3*td2 - s2*s3*td1)^2 - d3*(c3*s2*td1 - s3*td2)^2) + cx4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) - cz4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) - s4*(c3*g*s2 + d3*(c2*td1 + td3)*(c3*s2*td1 - s3*td2) + d3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2))) - (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(-cx4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + cy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) + (-cy4*(-c3*td2 - s2*s3*td1 + td4) + cz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)))*(-c3*td2 - s2*s3*td1 + td4)) - cy4*m4*(c4*(c3*g*s2 + d3*(c2*td1 + td3)*(c3*s2*td1 - s3*td2) + d3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2))) - cy4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) + cz4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - s4*(c2*g - d3*(-c3*td2 - s2*s3*td1)^2 - d3*(c3*s2*td1 - s3*td2)^2) + (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(-cx4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + cy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - (cx4*(-c3*td2 - s2*s3*td1 + td4) - cz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)))*(-c3*td2 - s2*s3*td1 + td4)) + cz3*m3*(c3*g*s2 - cy3*(c2*tdd1 - s2*td1*td2 + tdd3) + cz3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2)) - (c2*td1 + td3)*(cx3*(c2*td1 + td3) - cz3*(c3*s2*td1 - s3*td2)) + (-c3*td2 - s2*s3*td1)*(-cx3*(-c3*td2 - s2*s3*td1) + cy3*(c3*s2*td1 - s3*td2))) + d3*(c3*m4*(c4*(c3*g*s2 + d3*(c2*td1 + td3)*(c3*s2*td1 - s3*td2) + d3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2))) - cy4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) + cz4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - s4*(c2*g - d3*(-c3*td2 - s2*s3*td1)^2 - d3*(c3*s2*td1 - s3*td2)^2) + (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(-cx4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + cy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - (cx4*(-c3*td2 - s2*s3*td1 + td4) - cz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)))*(-c3*td2 - s2*s3*td1 + td4)) - m4*s3*(-c4*(c2*g - d3*(-c3*td2 - s2*s3*td1)^2 - d3*(c3*s2*td1 - s3*td2)^2) + cx4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) - cz4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) - s4*(c3*g*s2 + d3*(c2*td1 + td3)*(c3*s2*td1 - s3*td2) + d3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2))) - (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(-cx4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + cy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) + (-cy4*(-c3*td2 - s2*s3*td1 + td4) + cz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)))*(-c3*td2 - s2*s3*td1 + td4))) + (c2*td1 + td3)*(Ixx3*(c3*s2*td1 - s3*td2) - Ixy3*(-c3*td2 - s2*s3*td1) - Ixz3*(c2*td1 + td3)) - (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(Ixx4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)) - Ixy4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) - Ixz4*(-c3*td2 - s2*s3*td1 + td4)) + (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(-Ixy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)) + Iyy4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) - Iyz4*(-c3*td2 - s2*s3*td1 + td4)) - (c3*s2*td1 - s3*td2)*(-Ixz3*(c3*s2*td1 - s3*td2) - Iyz3*(-c3*td2 - s2*s3*td1) + Izz3*(c2*td1 + td3))) + cx1*m1*(cx1*tdd1 - cy1*td1^2) + cx2*m2*(c2*g + cx2*tdd2 - cz2*(c2*td1*td2 + s2*tdd1) - s2*td1*(-c2*cx2*td1 + cy2*s2*td1) + td2*(c2*cz2*td1 - cy2*td2)) - cy1*m1*(-cx1*td1^2 - cy1*tdd1) - cy2*m2*(c2*td1*(-c2*cx2*td1 + cy2*s2*td1) - cy2*tdd2 + cz2*(c2*tdd1 - s2*td1*td2) + g*s2 - td2*(cx2*td2 - cz2*s2*td1)) + s2*td1*(-Ixy2*s2*td1 + Iyy2*c2*td1 - Iyz2*td2) + s2*(Ixx3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - Ixy3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2)) - Ixz3*(c2*tdd1 - s2*td1*td2 + tdd3) + c3*(Ixx4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) - Ixy4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - Ixz4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) + cy4*m4*(-cx4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) + cy4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + d3*(c2*td1 + td3)*(-c3*td2 - s2*s3*td1) - d3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - g*s2*s3 - (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(-cy4*(-c3*td2 - s2*s3*td1 + td4) + cz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(cx4*(-c3*td2 - s2*s3*td1 + td4) - cz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)))) - cz4*m4*(-c4*(c2*g - d3*(-c3*td2 - s2*s3*td1)^2 - d3*(c3*s2*td1 - s3*td2)^2) + cx4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) - cz4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) - s4*(c3*g*s2 + d3*(c2*td1 + td3)*(c3*s2*td1 - s3*td2) + d3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2))) - (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(-cx4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + cy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) + (-cy4*(-c3*td2 - s2*s3*td1 + td4) + cz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)))*(-c3*td2 - s2*s3*td1 + td4)) + (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(-Ixz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)) - Iyz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + Izz4*(-c3*td2 - s2*s3*td1 + td4)) - (-Ixy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)) + Iyy4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) - Iyz4*(-c3*td2 - s2*s3*td1 + td4))*(-c3*td2 - s2*s3*td1 + td4)) + cy3*m3*(c2*g - cx3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2)) + cy3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - (-c3*td2 - s2*s3*td1)*(-cy3*(c2*td1 + td3) + cz3*(-c3*td2 - s2*s3*td1)) + (cx3*(c2*td1 + td3) - cz3*(c3*s2*td1 - s3*td2))*(c3*s2*td1 - s3*td2)) - cz3*m3*(cx3*(c2*tdd1 - s2*td1*td2 + tdd3) - cz3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - g*s2*s3 + (c2*td1 + td3)*(-cy3*(c2*td1 + td3) + cz3*(-c3*td2 - s2*s3*td1)) - (-cx3*(-c3*td2 - s2*s3*td1) + cy3*(c3*s2*td1 - s3*td2))*(c3*s2*td1 - s3*td2)) - d3*m4*(-cx4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) + cy4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + d3*(c2*td1 + td3)*(-c3*td2 - s2*s3*td1) - d3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - g*s2*s3 - (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(-cy4*(-c3*td2 - s2*s3*td1 + td4) + cz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(cx4*(-c3*td2 - s2*s3*td1 + td4) - cz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)))) - s3*(-Ixy4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + Iyy4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - Iyz4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) - cx4*m4*(-cx4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) + cy4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + d3*(c2*td1 + td3)*(-c3*td2 - s2*s3*td1) - d3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - g*s2*s3 - (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(-cy4*(-c3*td2 - s2*s3*td1 + td4) + cz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(cx4*(-c3*td2 - s2*s3*td1 + td4) - cz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)))) + cz4*m4*(c4*(c3*g*s2 + d3*(c2*td1 + td3)*(c3*s2*td1 - s3*td2) + d3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2))) - cy4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) + cz4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - s4*(c2*g - d3*(-c3*td2 - s2*s3*td1)^2 - d3*(c3*s2*td1 - s3*td2)^2) + (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(-cx4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + cy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - (cx4*(-c3*td2 - s2*s3*td1 + td4) - cz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)))*(-c3*td2 - s2*s3*td1 + td4)) - (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(-Ixz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)) - Iyz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + Izz4*(-c3*td2 - s2*s3*td1 + td4)) + (Ixx4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)) - Ixy4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) - Ixz4*(-c3*td2 - s2*s3*td1 + td4))*(-c3*td2 - s2*s3*td1 + td4)) - (c2*td1 + td3)*(-Ixy3*(c3*s2*td1 - s3*td2) + Iyy3*(-c3*td2 - s2*s3*td1) - Iyz3*(c2*td1 + td3)) + (-c3*td2 - s2*s3*td1)*(-Ixz3*(c3*s2*td1 - s3*td2) - Iyz3*(-c3*td2 - s2*s3*td1) + Izz3*(c2*td1 + td3)));

m11 = diff(a1,tdd1);
m12 = diff(a1,tdd2);
m13 = diff(a1,tdd3);
m14 = diff(a1,tdd4);

corio1=(td1*td1*diff(a1,td1,td1) + td1*td2*diff(a1,td1,td2) + td1*td3*diff(a1,td1,td3) + td1*td4*diff(a1,td1,td4)+...
        td2*td1*diff(a1,td2,td1) + td2*td2*diff(a1,td2,td2) + td2*td3*diff(a1,td2,td3) + td2*td4*diff(a1,td2,td4)+...
        td3*td1*diff(a1,td3,td1) + td3*td2*diff(a1,td3,td2) + td3*td3*diff(a1,td3,td3) + td3*td4*diff(a1,td3,td4)+...
        td4*td1*diff(a1,td4,td1) + td4*td2*diff(a1,td4,td2) + td4*td3*diff(a1,td4,td3) + td4*td4*diff(a1,td4,td4))/2;

ds_1g = diff(a1,g);
g1 =  ds_1g * g;

%% Link 2    
% str2 = "[-Ixz2*(c2*td1*td2 + s2*tdd1) - Iyz2*(c2*tdd1 - s2*td1*td2) + Izz2*tdd2 - c2*td1*(Ixx2*s2*td1 - Ixy2*c2*td1 - Ixz2*td2) + c2*(-Ixy3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - Ixz4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + Iyy3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2)) - Iyz3*(c2*tdd1 - s2*td1*td2 + tdd3) - Iyz4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) + Izz4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) - cx3*m3*(c2*g - cx3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2)) + cy3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - (-c3*td2 - s2*s3*td1)*(-cy3*(c2*td1 + td3) + cz3*(-c3*td2 - s2*s3*td1)) + (cx3*(c2*td1 + td3) - cz3*(c3*s2*td1 - s3*td2))*(c3*s2*td1 - s3*td2)) + cx4*m4*(-c4*(c2*g - d3*(-c3*td2 - s2*s3*td1)**2 - d3*(c3*s2*td1 - s3*td2)**2) + cx4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) - cz4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) - s4*(c3*g*s2 + d3*(c2*td1 + td3)*(c3*s2*td1 - s3*td2) + d3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2))) - (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(-cx4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + cy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) + (-cy4*(-c3*td2 - s2*s3*td1 + td4) + cz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)))*(-c3*td2 - s2*s3*td1 + td4)) - cy4*m4*(c4*(c3*g*s2 + d3*(c2*td1 + td3)*(c3*s2*td1 - s3*td2) + d3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2))) - cy4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) + cz4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - s4*(c2*g - d3*(-c3*td2 - s2*s3*td1)**2 - d3*(c3*s2*td1 - s3*td2)**2) + (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(-cx4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + cy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - (cx4*(-c3*td2 - s2*s3*td1 + td4) - cz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)))*(-c3*td2 - s2*s3*td1 + td4)) + cz3*m3*(c3*g*s2 - cy3*(c2*tdd1 - s2*td1*td2 + tdd3) + cz3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2)) - (c2*td1 + td3)*(cx3*(c2*td1 + td3) - cz3*(c3*s2*td1 - s3*td2)) + (-c3*td2 - s2*s3*td1)*(-cx3*(-c3*td2 - s2*s3*td1) + cy3*(c3*s2*td1 - s3*td2))) + d3*(c3*m4*(c4*(c3*g*s2 + d3*(c2*td1 + td3)*(c3*s2*td1 - s3*td2) + d3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2))) - cy4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) + cz4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - s4*(c2*g - d3*(-c3*td2 - s2*s3*td1)**2 - d3*(c3*s2*td1 - s3*td2)**2) + (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(-cx4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + cy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - (cx4*(-c3*td2 - s2*s3*td1 + td4) - cz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)))*(-c3*td2 - s2*s3*td1 + td4)) - m4*s3*(-c4*(c2*g - d3*(-c3*td2 - s2*s3*td1)**2 - d3*(c3*s2*td1 - s3*td2)**2) + cx4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) - cz4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) - s4*(c3*g*s2 + d3*(c2*td1 + td3)*(c3*s2*td1 - s3*td2) + d3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2))) - (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(-cx4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + cy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) + (-cy4*(-c3*td2 - s2*s3*td1 + td4) + cz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)))*(-c3*td2 - s2*s3*td1 + td4))) + (c2*td1 + td3)*(Ixx3*(c3*s2*td1 - s3*td2) - Ixy3*(-c3*td2 - s2*s3*td1) - Ixz3*(c2*td1 + td3)) - (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(Ixx4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)) - Ixy4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) - Ixz4*(-c3*td2 - s2*s3*td1 + td4)) + (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(-Ixy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)) + Iyy4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) - Iyz4*(-c3*td2 - s2*s3*td1 + td4)) - (c3*s2*td1 - s3*td2)*(-Ixz3*(c3*s2*td1 - s3*td2) - Iyz3*(-c3*td2 - s2*s3*td1) + Izz3*(c2*td1 + td3))) + cx2*m2*(c2*g + cx2*tdd2 - cz2*(c2*td1*td2 + s2*tdd1) - s2*td1*(-c2*cx2*td1 + cy2*s2*td1) + td2*(c2*cz2*td1 - cy2*td2)) - cy2*m2*(c2*td1*(-c2*cx2*td1 + cy2*s2*td1) - cy2*tdd2 + cz2*(c2*tdd1 - s2*td1*td2) + g*s2 - td2*(cx2*td2 - cz2*s2*td1)) + s2*td1*(-Ixy2*s2*td1 + Iyy2*c2*td1 - Iyz2*td2) + s2*(Ixx3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - Ixy3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2)) - Ixz3*(c2*tdd1 - s2*td1*td2 + tdd3) + c3*(Ixx4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) - Ixy4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - Ixz4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) + cy4*m4*(-cx4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) + cy4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + d3*(c2*td1 + td3)*(-c3*td2 - s2*s3*td1) - d3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - g*s2*s3 - (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(-cy4*(-c3*td2 - s2*s3*td1 + td4) + cz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(cx4*(-c3*td2 - s2*s3*td1 + td4) - cz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)))) - cz4*m4*(-c4*(c2*g - d3*(-c3*td2 - s2*s3*td1)**2 - d3*(c3*s2*td1 - s3*td2)**2) + cx4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) - cz4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) - s4*(c3*g*s2 + d3*(c2*td1 + td3)*(c3*s2*td1 - s3*td2) + d3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2))) - (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(-cx4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + cy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) + (-cy4*(-c3*td2 - s2*s3*td1 + td4) + cz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)))*(-c3*td2 - s2*s3*td1 + td4)) + (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(-Ixz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)) - Iyz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + Izz4*(-c3*td2 - s2*s3*td1 + td4)) - (-Ixy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)) + Iyy4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) - Iyz4*(-c3*td2 - s2*s3*td1 + td4))*(-c3*td2 - s2*s3*td1 + td4)) + cy3*m3*(c2*g - cx3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2)) + cy3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - (-c3*td2 - s2*s3*td1)*(-cy3*(c2*td1 + td3) + cz3*(-c3*td2 - s2*s3*td1)) + (cx3*(c2*td1 + td3) - cz3*(c3*s2*td1 - s3*td2))*(c3*s2*td1 - s3*td2)) - cz3*m3*(cx3*(c2*tdd1 - s2*td1*td2 + tdd3) - cz3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - g*s2*s3 + (c2*td1 + td3)*(-cy3*(c2*td1 + td3) + cz3*(-c3*td2 - s2*s3*td1)) - (-cx3*(-c3*td2 - s2*s3*td1) + cy3*(c3*s2*td1 - s3*td2))*(c3*s2*td1 - s3*td2)) - d3*m4*(-cx4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) + cy4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + d3*(c2*td1 + td3)*(-c3*td2 - s2*s3*td1) - d3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - g*s2*s3 - (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(-cy4*(-c3*td2 - s2*s3*td1 + td4) + cz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(cx4*(-c3*td2 - s2*s3*td1 + td4) - cz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)))) - s3*(-Ixy4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + Iyy4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - Iyz4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) - cx4*m4*(-cx4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) + cy4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + d3*(c2*td1 + td3)*(-c3*td2 - s2*s3*td1) - d3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - g*s2*s3 - (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(-cy4*(-c3*td2 - s2*s3*td1 + td4) + cz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(cx4*(-c3*td2 - s2*s3*td1 + td4) - cz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)))) + cz4*m4*(c4*(c3*g*s2 + d3*(c2*td1 + td3)*(c3*s2*td1 - s3*td2) + d3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2))) - cy4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) + cz4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - s4*(c2*g - d3*(-c3*td2 - s2*s3*td1)**2 - d3*(c3*s2*td1 - s3*td2)**2) + (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(-cx4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + cy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - (cx4*(-c3*td2 - s2*s3*td1 + td4) - cz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)))*(-c3*td2 - s2*s3*td1 + td4)) - (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(-Ixz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)) - Iyz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + Izz4*(-c3*td2 - s2*s3*td1 + td4)) + (Ixx4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)) - Ixy4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) - Ixz4*(-c3*td2 - s2*s3*td1 + td4))*(-c3*td2 - s2*s3*td1 + td4)) - (c2*td1 + td3)*(-Ixy3*(c3*s2*td1 - s3*td2) + Iyy3*(-c3*td2 - s2*s3*td1) - Iyz3*(c2*td1 + td3)) + (-c3*td2 - s2*s3*td1)*(-Ixz3*(c3*s2*td1 - s3*td2) - Iyz3*(-c3*td2 - s2*s3*td1) + Izz3*(c2*td1 + td3)))]"
% newStr2 = replace(str2,"**2","^2")

a2 = -Ixz2*(c2*td1*td2 + s2*tdd1) - Iyz2*(c2*tdd1 - s2*td1*td2) + Izz2*tdd2 - c2*td1*(Ixx2*s2*td1 - Ixy2*c2*td1 - Ixz2*td2) + c2*(-Ixy3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - Ixz4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + Iyy3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2)) - Iyz3*(c2*tdd1 - s2*td1*td2 + tdd3) - Iyz4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) + Izz4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) - cx3*m3*(c2*g - cx3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2)) + cy3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - (-c3*td2 - s2*s3*td1)*(-cy3*(c2*td1 + td3) + cz3*(-c3*td2 - s2*s3*td1)) + (cx3*(c2*td1 + td3) - cz3*(c3*s2*td1 - s3*td2))*(c3*s2*td1 - s3*td2)) + cx4*m4*(-c4*(c2*g - d3*(-c3*td2 - s2*s3*td1)^2 - d3*(c3*s2*td1 - s3*td2)^2) + cx4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) - cz4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) - s4*(c3*g*s2 + d3*(c2*td1 + td3)*(c3*s2*td1 - s3*td2) + d3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2))) - (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(-cx4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + cy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) + (-cy4*(-c3*td2 - s2*s3*td1 + td4) + cz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)))*(-c3*td2 - s2*s3*td1 + td4)) - cy4*m4*(c4*(c3*g*s2 + d3*(c2*td1 + td3)*(c3*s2*td1 - s3*td2) + d3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2))) - cy4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) + cz4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - s4*(c2*g - d3*(-c3*td2 - s2*s3*td1)^2 - d3*(c3*s2*td1 - s3*td2)^2) + (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(-cx4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + cy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - (cx4*(-c3*td2 - s2*s3*td1 + td4) - cz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)))*(-c3*td2 - s2*s3*td1 + td4)) + cz3*m3*(c3*g*s2 - cy3*(c2*tdd1 - s2*td1*td2 + tdd3) + cz3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2)) - (c2*td1 + td3)*(cx3*(c2*td1 + td3) - cz3*(c3*s2*td1 - s3*td2)) + (-c3*td2 - s2*s3*td1)*(-cx3*(-c3*td2 - s2*s3*td1) + cy3*(c3*s2*td1 - s3*td2))) + d3*(c3*m4*(c4*(c3*g*s2 + d3*(c2*td1 + td3)*(c3*s2*td1 - s3*td2) + d3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2))) - cy4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) + cz4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - s4*(c2*g - d3*(-c3*td2 - s2*s3*td1)^2 - d3*(c3*s2*td1 - s3*td2)^2) + (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(-cx4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + cy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - (cx4*(-c3*td2 - s2*s3*td1 + td4) - cz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)))*(-c3*td2 - s2*s3*td1 + td4)) - m4*s3*(-c4*(c2*g - d3*(-c3*td2 - s2*s3*td1)^2 - d3*(c3*s2*td1 - s3*td2)^2) + cx4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) - cz4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) - s4*(c3*g*s2 + d3*(c2*td1 + td3)*(c3*s2*td1 - s3*td2) + d3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2))) - (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(-cx4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + cy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) + (-cy4*(-c3*td2 - s2*s3*td1 + td4) + cz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)))*(-c3*td2 - s2*s3*td1 + td4))) + (c2*td1 + td3)*(Ixx3*(c3*s2*td1 - s3*td2) - Ixy3*(-c3*td2 - s2*s3*td1) - Ixz3*(c2*td1 + td3)) - (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(Ixx4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)) - Ixy4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) - Ixz4*(-c3*td2 - s2*s3*td1 + td4)) + (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(-Ixy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)) + Iyy4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) - Iyz4*(-c3*td2 - s2*s3*td1 + td4)) - (c3*s2*td1 - s3*td2)*(-Ixz3*(c3*s2*td1 - s3*td2) - Iyz3*(-c3*td2 - s2*s3*td1) + Izz3*(c2*td1 + td3))) + cx2*m2*(c2*g + cx2*tdd2 - cz2*(c2*td1*td2 + s2*tdd1) - s2*td1*(-c2*cx2*td1 + cy2*s2*td1) + td2*(c2*cz2*td1 - cy2*td2)) - cy2*m2*(c2*td1*(-c2*cx2*td1 + cy2*s2*td1) - cy2*tdd2 + cz2*(c2*tdd1 - s2*td1*td2) + g*s2 - td2*(cx2*td2 - cz2*s2*td1)) + s2*td1*(-Ixy2*s2*td1 + Iyy2*c2*td1 - Iyz2*td2) + s2*(Ixx3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - Ixy3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2)) - Ixz3*(c2*tdd1 - s2*td1*td2 + tdd3) + c3*(Ixx4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) - Ixy4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - Ixz4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) + cy4*m4*(-cx4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) + cy4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + d3*(c2*td1 + td3)*(-c3*td2 - s2*s3*td1) - d3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - g*s2*s3 - (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(-cy4*(-c3*td2 - s2*s3*td1 + td4) + cz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(cx4*(-c3*td2 - s2*s3*td1 + td4) - cz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)))) - cz4*m4*(-c4*(c2*g - d3*(-c3*td2 - s2*s3*td1)^2 - d3*(c3*s2*td1 - s3*td2)^2) + cx4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) - cz4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) - s4*(c3*g*s2 + d3*(c2*td1 + td3)*(c3*s2*td1 - s3*td2) + d3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2))) - (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(-cx4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + cy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) + (-cy4*(-c3*td2 - s2*s3*td1 + td4) + cz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)))*(-c3*td2 - s2*s3*td1 + td4)) + (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(-Ixz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)) - Iyz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + Izz4*(-c3*td2 - s2*s3*td1 + td4)) - (-Ixy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)) + Iyy4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) - Iyz4*(-c3*td2 - s2*s3*td1 + td4))*(-c3*td2 - s2*s3*td1 + td4)) + cy3*m3*(c2*g - cx3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2)) + cy3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - (-c3*td2 - s2*s3*td1)*(-cy3*(c2*td1 + td3) + cz3*(-c3*td2 - s2*s3*td1)) + (cx3*(c2*td1 + td3) - cz3*(c3*s2*td1 - s3*td2))*(c3*s2*td1 - s3*td2)) - cz3*m3*(cx3*(c2*tdd1 - s2*td1*td2 + tdd3) - cz3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - g*s2*s3 + (c2*td1 + td3)*(-cy3*(c2*td1 + td3) + cz3*(-c3*td2 - s2*s3*td1)) - (-cx3*(-c3*td2 - s2*s3*td1) + cy3*(c3*s2*td1 - s3*td2))*(c3*s2*td1 - s3*td2)) - d3*m4*(-cx4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) + cy4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + d3*(c2*td1 + td3)*(-c3*td2 - s2*s3*td1) - d3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - g*s2*s3 - (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(-cy4*(-c3*td2 - s2*s3*td1 + td4) + cz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(cx4*(-c3*td2 - s2*s3*td1 + td4) - cz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)))) - s3*(-Ixy4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + Iyy4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - Iyz4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) - cx4*m4*(-cx4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) + cy4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + d3*(c2*td1 + td3)*(-c3*td2 - s2*s3*td1) - d3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - g*s2*s3 - (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(-cy4*(-c3*td2 - s2*s3*td1 + td4) + cz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(cx4*(-c3*td2 - s2*s3*td1 + td4) - cz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)))) + cz4*m4*(c4*(c3*g*s2 + d3*(c2*td1 + td3)*(c3*s2*td1 - s3*td2) + d3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2))) - cy4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) + cz4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - s4*(c2*g - d3*(-c3*td2 - s2*s3*td1)^2 - d3*(c3*s2*td1 - s3*td2)^2) + (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(-cx4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + cy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - (cx4*(-c3*td2 - s2*s3*td1 + td4) - cz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)))*(-c3*td2 - s2*s3*td1 + td4)) - (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(-Ixz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)) - Iyz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + Izz4*(-c3*td2 - s2*s3*td1 + td4)) + (Ixx4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)) - Ixy4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) - Ixz4*(-c3*td2 - s2*s3*td1 + td4))*(-c3*td2 - s2*s3*td1 + td4)) - (c2*td1 + td3)*(-Ixy3*(c3*s2*td1 - s3*td2) + Iyy3*(-c3*td2 - s2*s3*td1) - Iyz3*(c2*td1 + td3)) + (-c3*td2 - s2*s3*td1)*(-Ixz3*(c3*s2*td1 - s3*td2) - Iyz3*(-c3*td2 - s2*s3*td1) + Izz3*(c2*td1 + td3)));

m21 = diff(a2,tdd1);
m22 = diff(a2,tdd2);
m23 = diff(a2,tdd3);
m24 = diff(a2,tdd4);
 
corio2=(td1*td1*diff(a2,td1,td1) + td1*td2*diff(a2,td1,td2) + td1*td3*diff(a2,td1,td3) + td1*td4*diff(a2,td1,td4)+...
        td2*td1*diff(a2,td2,td1) + td2*td2*diff(a2,td2,td2) + td2*td3*diff(a2,td2,td3) + td2*td4*diff(a2,td2,td4)+...
        td3*td1*diff(a2,td3,td1) + td3*td2*diff(a2,td3,td2) + td3*td3*diff(a2,td3,td3) + td3*td4*diff(a2,td3,td4)+...
        td4*td1*diff(a2,td4,td1) + td4*td2*diff(a2,td4,td2) + td4*td3*diff(a2,td4,td3) + td4*td4*diff(a2,td4,td4))/2;

ds_2g = diff(a2,g);
g2 =  ds_2g * g;

%% Link 3

% str3="[-Ixz3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - Iyz3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2)) + Izz3*(c2*tdd1 - s2*td1*td2 + tdd3) - c3*(-Ixy4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + Iyy4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - Iyz4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) - cx4*m4*(-cx4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) + cy4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + d3*(c2*td1 + td3)*(-c3*td2 - s2*s3*td1) - d3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - g*s2*s3 - (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(-cy4*(-c3*td2 - s2*s3*td1 + td4) + cz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(cx4*(-c3*td2 - s2*s3*td1 + td4) - cz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)))) + cz4*m4*(c4*(c3*g*s2 + d3*(c2*td1 + td3)*(c3*s2*td1 - s3*td2) + d3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2))) - cy4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) + cz4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - s4*(c2*g - d3*(-c3*td2 - s2*s3*td1)**2 - d3*(c3*s2*td1 - s3*td2)**2) + (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(-cx4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + cy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - (cx4*(-c3*td2 - s2*s3*td1 + td4) - cz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)))*(-c3*td2 - s2*s3*td1 + td4)) - (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(-Ixz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)) - Iyz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + Izz4*(-c3*td2 - s2*s3*td1 + td4)) + (Ixx4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)) - Ixy4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) - Ixz4*(-c3*td2 - s2*s3*td1 + td4))*(-c3*td2 - s2*s3*td1 + td4)) + cx3*m3*(cx3*(c2*tdd1 - s2*td1*td2 + tdd3) - cz3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - g*s2*s3 + (c2*td1 + td3)*(-cy3*(c2*td1 + td3) + cz3*(-c3*td2 - s2*s3*td1)) - (-cx3*(-c3*td2 - s2*s3*td1) + cy3*(c3*s2*td1 - s3*td2))*(c3*s2*td1 - s3*td2)) - cy3*m3*(c3*g*s2 - cy3*(c2*tdd1 - s2*td1*td2 + tdd3) + cz3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2)) - (c2*td1 + td3)*(cx3*(c2*td1 + td3) - cz3*(c3*s2*td1 - s3*td2)) + (-c3*td2 - s2*s3*td1)*(-cx3*(-c3*td2 - s2*s3*td1) + cy3*(c3*s2*td1 - s3*td2))) - s3*(Ixx4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) - Ixy4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - Ixz4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) + cy4*m4*(-cx4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) + cy4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + d3*(c2*td1 + td3)*(-c3*td2 - s2*s3*td1) - d3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - g*s2*s3 - (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(-cy4*(-c3*td2 - s2*s3*td1 + td4) + cz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(cx4*(-c3*td2 - s2*s3*td1 + td4) - cz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)))) - cz4*m4*(-c4*(c2*g - d3*(-c3*td2 - s2*s3*td1)**2 - d3*(c3*s2*td1 - s3*td2)**2) + cx4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) - cz4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) - s4*(c3*g*s2 + d3*(c2*td1 + td3)*(c3*s2*td1 - s3*td2) + d3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2))) - (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(-cx4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + cy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) + (-cy4*(-c3*td2 - s2*s3*td1 + td4) + cz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)))*(-c3*td2 - s2*s3*td1 + td4)) + (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(-Ixz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)) - Iyz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + Izz4*(-c3*td2 - s2*s3*td1 + td4)) - (-Ixy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)) + Iyy4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) - Iyz4*(-c3*td2 - s2*s3*td1 + td4))*(-c3*td2 - s2*s3*td1 + td4)) - (-c3*td2 - s2*s3*td1)*(Ixx3*(c3*s2*td1 - s3*td2) - Ixy3*(-c3*td2 - s2*s3*td1) - Ixz3*(c2*td1 + td3)) + (c3*s2*td1 - s3*td2)*(-Ixy3*(c3*s2*td1 - s3*td2) + Iyy3*(-c3*td2 - s2*s3*td1) - Iyz3*(c2*td1 + td3))]"
% newStr3 = replace(str3,"**2","^2")

a3 = -Ixz3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - Iyz3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2)) + Izz3*(c2*tdd1 - s2*td1*td2 + tdd3) - c3*(-Ixy4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + Iyy4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - Iyz4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) - cx4*m4*(-cx4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) + cy4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + d3*(c2*td1 + td3)*(-c3*td2 - s2*s3*td1) - d3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - g*s2*s3 - (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(-cy4*(-c3*td2 - s2*s3*td1 + td4) + cz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(cx4*(-c3*td2 - s2*s3*td1 + td4) - cz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)))) + cz4*m4*(c4*(c3*g*s2 + d3*(c2*td1 + td3)*(c3*s2*td1 - s3*td2) + d3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2))) - cy4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) + cz4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - s4*(c2*g - d3*(-c3*td2 - s2*s3*td1)^2 - d3*(c3*s2*td1 - s3*td2)^2) + (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(-cx4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + cy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - (cx4*(-c3*td2 - s2*s3*td1 + td4) - cz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)))*(-c3*td2 - s2*s3*td1 + td4)) - (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(-Ixz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)) - Iyz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + Izz4*(-c3*td2 - s2*s3*td1 + td4)) + (Ixx4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)) - Ixy4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) - Ixz4*(-c3*td2 - s2*s3*td1 + td4))*(-c3*td2 - s2*s3*td1 + td4)) + cx3*m3*(cx3*(c2*tdd1 - s2*td1*td2 + tdd3) - cz3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - g*s2*s3 + (c2*td1 + td3)*(-cy3*(c2*td1 + td3) + cz3*(-c3*td2 - s2*s3*td1)) - (-cx3*(-c3*td2 - s2*s3*td1) + cy3*(c3*s2*td1 - s3*td2))*(c3*s2*td1 - s3*td2)) - cy3*m3*(c3*g*s2 - cy3*(c2*tdd1 - s2*td1*td2 + tdd3) + cz3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2)) - (c2*td1 + td3)*(cx3*(c2*td1 + td3) - cz3*(c3*s2*td1 - s3*td2)) + (-c3*td2 - s2*s3*td1)*(-cx3*(-c3*td2 - s2*s3*td1) + cy3*(c3*s2*td1 - s3*td2))) - s3*(Ixx4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) - Ixy4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - Ixz4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) + cy4*m4*(-cx4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) + cy4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + d3*(c2*td1 + td3)*(-c3*td2 - s2*s3*td1) - d3*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - g*s2*s3 - (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(-cy4*(-c3*td2 - s2*s3*td1 + td4) + cz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) + (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(cx4*(-c3*td2 - s2*s3*td1 + td4) - cz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)))) - cz4*m4*(-c4*(c2*g - d3*(-c3*td2 - s2*s3*td1)^2 - d3*(c3*s2*td1 - s3*td2)^2) + cx4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) - cz4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) - s4*(c3*g*s2 + d3*(c2*td1 + td3)*(c3*s2*td1 - s3*td2) + d3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2))) - (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(-cx4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + cy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) + (-cy4*(-c3*td2 - s2*s3*td1 + td4) + cz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)))*(-c3*td2 - s2*s3*td1 + td4)) + (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(-Ixz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)) - Iyz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + Izz4*(-c3*td2 - s2*s3*td1 + td4)) - (-Ixy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)) + Iyy4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) - Iyz4*(-c3*td2 - s2*s3*td1 + td4))*(-c3*td2 - s2*s3*td1 + td4)) - (-c3*td2 - s2*s3*td1)*(Ixx3*(c3*s2*td1 - s3*td2) - Ixy3*(-c3*td2 - s2*s3*td1) - Ixz3*(c2*td1 + td3)) + (c3*s2*td1 - s3*td2)*(-Ixy3*(c3*s2*td1 - s3*td2) + Iyy3*(-c3*td2 - s2*s3*td1) - Iyz3*(c2*td1 + td3));

m31 = diff(a3,tdd1);
m32 = diff(a3,tdd2);
m33 = diff(a3,tdd3);
m34 = diff(a3,tdd4);

corio3=(td1*td1*diff(a3,td1,td1) + td1*td2*diff(a3,td1,td2) + td1*td3*diff(a3,td1,td3) + td1*td4*diff(a3,td1,td4)+...
        td2*td1*diff(a3,td2,td1) + td2*td2*diff(a3,td2,td2) + td2*td3*diff(a3,td2,td3) + td2*td4*diff(a3,td2,td4)+...
        td3*td1*diff(a3,td3,td1) + td3*td2*diff(a3,td3,td2) + td3*td3*diff(a3,td3,td3) + td3*td4*diff(a3,td3,td4)+...
        td4*td1*diff(a3,td4,td1) + td4*td2*diff(a3,td4,td2) + td4*td3*diff(a3,td4,td3) + td4*td4*diff(a3,td4,td4))/2;
    
ds_3g = diff(a3,g);
g3 =  ds_3g * g;

%% Link 4
% str4="[-Ixz4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) - Iyz4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) + Izz4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) + cx4*m4*(-c4*(c2*g - d3*(-c3*td2 - s2*s3*td1)**2 - d3*(c3*s2*td1 - s3*td2)**2) + cx4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) - cz4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) - s4*(c3*g*s2 + d3*(c2*td1 + td3)*(c3*s2*td1 - s3*td2) + d3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2))) - (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(-cx4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + cy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) + (-cy4*(-c3*td2 - s2*s3*td1 + td4) + cz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)))*(-c3*td2 - s2*s3*td1 + td4)) - cy4*m4*(c4*(c3*g*s2 + d3*(c2*td1 + td3)*(c3*s2*td1 - s3*td2) + d3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2))) - cy4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) + cz4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - s4*(c2*g - d3*(-c3*td2 - s2*s3*td1)**2 - d3*(c3*s2*td1 - s3*td2)**2) + (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(-cx4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + cy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - (cx4*(-c3*td2 - s2*s3*td1 + td4) - cz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)))*(-c3*td2 - s2*s3*td1 + td4)) - (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(Ixx4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)) - Ixy4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) - Ixz4*(-c3*td2 - s2*s3*td1 + td4)) + (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(-Ixy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)) + Iyy4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) - Iyz4*(-c3*td2 - s2*s3*td1 + td4))]"
% newStr4 = replace(str4,"**2","^2")

a4 = -Ixz4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) - Iyz4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) + Izz4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) + cx4*m4*(-c4*(c2*g - d3*(-c3*td2 - s2*s3*td1)^2 - d3*(c3*s2*td1 - s3*td2)^2) + cx4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) - cz4*(c4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - s4*(c2*tdd1 - s2*td1*td2 + tdd3) + td4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))) - s4*(c3*g*s2 + d3*(c2*td1 + td3)*(c3*s2*td1 - s3*td2) + d3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2))) - (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(-cx4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + cy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) + (-cy4*(-c3*td2 - s2*s3*td1 + td4) + cz4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)))*(-c3*td2 - s2*s3*td1 + td4)) - cy4*m4*(c4*(c3*g*s2 + d3*(c2*td1 + td3)*(c3*s2*td1 - s3*td2) + d3*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2))) - cy4*(-c3*tdd2 - s3*(c2*td1*td2 + s2*tdd1) - td3*(c3*s2*td1 - s3*td2) + tdd4) + cz4*(-c4*(c2*tdd1 - s2*td1*td2 + tdd3) - s4*(c3*(c2*td1*td2 + s2*tdd1) - s3*tdd2 + td3*(-c3*td2 - s2*s3*td1)) - td4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - s4*(c2*g - d3*(-c3*td2 - s2*s3*td1)^2 - d3*(c3*s2*td1 - s3*td2)^2) + (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(-cx4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) + cy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))) - (cx4*(-c3*td2 - s2*s3*td1 + td4) - cz4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)))*(-c3*td2 - s2*s3*td1 + td4)) - (-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2))*(Ixx4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)) - Ixy4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) - Ixz4*(-c3*td2 - s2*s3*td1 + td4)) + (c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3))*(-Ixy4*(c4*(c3*s2*td1 - s3*td2) - s4*(c2*td1 + td3)) + Iyy4*(-c4*(c2*td1 + td3) - s4*(c3*s2*td1 - s3*td2)) - Iyz4*(-c3*td2 - s2*s3*td1 + td4));

m41 = diff(a4,tdd1);
m42 = diff(a4,tdd2);
m43 = diff(a4,tdd3);
m44 = diff(a4,tdd4);

corio4=(td1*td1*diff(a4,td1,td1) + td1*td2*diff(a4,td1,td2) + td1*td3*diff(a4,td1,td3) + td1*td4*diff(a4,td1,td4)+...
        td2*td1*diff(a4,td2,td1) + td2*td2*diff(a4,td2,td2) + td2*td3*diff(a4,td2,td3) + td2*td4*diff(a4,td2,td4)+...
        td3*td1*diff(a4,td3,td1) + td3*td2*diff(a4,td3,td2) + td3*td3*diff(a4,td3,td3) + td3*td4*diff(a4,td3,td4)+...
        td4*td1*diff(a4,td4,td1) + td4*td2*diff(a4,td4,td2) + td4*td3*diff(a4,td4,td3) + td4*td4*diff(a4,td4,td4))/2;
    
ds_4g = diff(a4,g);
g4 =  ds_4g * g;

%% matrix

% tau = M*tdd + V + G 
M = [m11 m12 m13 m14;
     m21 m22 m23 m24;
     m31 m32 m33 m34;
     m41 m42 m43 m44];

V = [corio1;
     corio2;
     corio3;
     corio4];
 
G = [g1;
     g2;
     g3;
     g4];